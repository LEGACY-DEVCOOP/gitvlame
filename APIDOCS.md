# GitVlame API ëª…ì„¸ì„œ (API Documentation)

GitVlameì˜ ë°±ì—”ë“œ API ìƒì„¸ ëª…ì„¸ì„œì…ë‹ˆë‹¤. ëª¨ë“  API ìš”ì²­ì€ ê¸°ë³¸ì ìœ¼ë¡œ ì¸ì¦ í† í°ì´ í•„ìš”í•©ë‹ˆë‹¤ (ë¡œê·¸ì¸ ì œì™¸).

## ğŸ” ì¸ì¦ (Authentication) - `/auth`

### 1. GitHub ë¡œê·¸ì¸
- **URL**: `/auth/github/login`
- **Method**: `GET`
- **ì„¤ëª…**: ì‚¬ìš©ìë¥¼ GitHub OAuth ìŠ¹ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•©ë‹ˆë‹¤.
- **ì‘ë‹µ**: `307 Temporary Redirect` (GitHub ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™)

### 2. GitHub ì½œë°± ì²˜ë¦¬
- **URL**: `/auth/github/callback`
- **Method**: `GET`
- **Query Parameters**:
  - `code`: GitHubì—ì„œ ë°œê¸‰ë°›ì€ ìŠ¹ì¸ ì½”ë“œ
- **ì„¤ëª…**: GitHubì—ì„œ ë¦¬ë‹¤ì´ë ‰íŠ¸ëœ í›„, ì½”ë“œë¥¼ ì ‘ê·¼ í† í°(Access Token)ìœ¼ë¡œ êµí™˜í•˜ê³  ì‚¬ìš©ìë¥¼ ìƒì„±/ê°±ì‹ í•©ë‹ˆë‹¤. JWT í† í°ì„ ìƒì„±í•˜ì—¬ í”„ë¡ íŠ¸ì—”ë“œë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
- **ì‘ë‹µ**: í”„ë¡ íŠ¸ì—”ë“œ URLë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (`?token=JWT_TOKEN` í¬í•¨)

### 3. ë‚´ ì •ë³´ ì¡°íšŒ
- **URL**: `/auth/me`
- **Method**: `GET`
- **Headers**: `Authorization: Bearer <jwt_token>`
- **ì„¤ëª…**: í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
- **ì‘ë‹µ ì˜ˆì‹œ**:
  ```json
  {
    "id": "uuid-string",
    "username": "github-user",
    "avatar_url": "https://avatars.githubusercontent.com/u/...",
    "created_at": "2024-12-17T10:00:00"
  }
  ```

### 4. ë¡œê·¸ì•„ì›ƒ
- **URL**: `/auth/logout`
- **Method**: `POST`
- **ì„¤ëª…**: ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬í•©ë‹ˆë‹¤. (í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ í† í° ì‚­ì œ í•„ìš”)

---

## ğŸ™ GitHub ë°ì´í„° (GitHub Data) - `/github`

### 5. ë ˆí¬ì§€í† ë¦¬ ëª©ë¡ ì¡°íšŒ
- **URL**: `/github/repos`
- **Method**: `GET`
- **Query Parameters**:
  - `page`: í˜ì´ì§€ ë²ˆí˜¸ (ê¸°ë³¸ê°’: 1)
  - `per_page`: í˜ì´ì§€ë‹¹ ê°œìˆ˜ (ê¸°ë³¸ê°’: 30)
  - `sort`: ì •ë ¬ ê¸°ì¤€ (ê¸°ë³¸ê°’: "updated")
- **ì„¤ëª…**: ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ì ‘ê·¼ ê°€ëŠ¥í•œ ë ˆí¬ì§€í† ë¦¬ ëª©ë¡ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.

### 6. ë ˆí¬ì§€í† ë¦¬ ê¸°ì—¬ì ì¡°íšŒ
- **URL**: `/github/repos/{owner}/{repo}/contributors`
- **Method**: `GET`
- **ì„¤ëª…**: íŠ¹ì • ë ˆí¬ì§€í† ë¦¬ì˜ ê¸°ì—¬ì(Contributor) ëª©ë¡ê³¼ ê¸°ì—¬ í†µê³„ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

### 7. ì»¤ë°‹ ê¸°ë¡ ì¡°íšŒ
- **URL**: `/github/repos/{owner}/{repo}/commits`
- **Method**: `GET`
- **Query Parameters**:
  - `path`: (ì„ íƒ) íŠ¹ì • íŒŒì¼ ê²½ë¡œë¡œ í•„í„°ë§
  - `since`: (ì„ íƒ) ì¡°íšŒ ì‹œì‘ ë‚ ì§œ (ISO 8601 í˜•ì‹)
  - `per_page`: (ì„ íƒ) ê°€ì ¸ì˜¬ ì»¤ë°‹ ìˆ˜
- **ì„¤ëª…**: ë ˆí¬ì§€í† ë¦¬ì˜ ì»¤ë°‹ íˆìŠ¤í† ë¦¬ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. `path` íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • íŒŒì¼ì˜ ë³€ê²½ ì´ë ¥ë§Œ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 8. ë ˆí¬ì§€í† ë¦¬ íŒŒì¼ íŠ¸ë¦¬ ì¡°íšŒ
- **URL**: `/github/repos/{owner}/{repo}/tree`
- **Method**: `GET`
- **Query Parameters**:
  - `branch`: (ì„ íƒ) ë¸Œëœì¹˜ ì´ë¦„ (ê¸°ë³¸ê°’: "main")
- **ì„¤ëª…**: ë ˆí¬ì§€í† ë¦¬ì˜ ì „ì²´ íŒŒì¼ ë° ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¥¼ ì¬ê·€ì ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤. `main` ë¸Œëœì¹˜ê°€ ì—†ì„ ê²½ìš° ìë™ìœ¼ë¡œ `master` ë¸Œëœì¹˜ë¥¼ ì‹œë„í•©ë‹ˆë‹¤.
- **ì‘ë‹µ ì˜ˆì‹œ**:
  ```json
  {
    "sha": "abc123...",
    "url": "https://api.github.com/repos/owner/repo/git/trees/main",
    "tree": [
      {
        "path": "src/main.py",
        "type": "blob",
        "sha": "def456...",
        "size": 1234,
        "url": "https://api.github.com/..."
      },
      {
        "path": "src/utils",
        "type": "tree",
        "sha": "ghi789...",
        "size": null,
        "url": "https://api.github.com/..."
      }
    ],
    "truncated": false
  }
  ```
- **ì°¸ê³ **:
  - `type`ì´ `"blob"`ì¸ ê²½ìš° íŒŒì¼, `"tree"`ì¸ ê²½ìš° ë””ë ‰í† ë¦¬ì…ë‹ˆë‹¤.
  - `truncated`ê°€ `true`ì´ë©´ ê²°ê³¼ê°€ ì˜ë ¸ìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤ (ëŒ€ìš©ëŸ‰ ë ˆí¬ì§€í† ë¦¬ì˜ ê²½ìš°).

---

## âš–ï¸ íŒê²° ë° ê³ ì†Œ (Judgments) - `/judgments`

### 9. ê³ ì†Œì¥ ì ‘ìˆ˜ (íŒê²° ìƒì„±)
- **URL**: `/judgments`
- **Method**: `POST`
- **Body**:
  ```json
  {
    "repo_owner": "owner_name",
    "repo_name": "repo_name",
    "title": "ì‚¬ê±´ ì œëª© (ì˜ˆ: ë©”ì¸ í˜ì´ì§€ ë Œë”ë§ ë²„ê·¸)",
    "description": "ë²„ê·¸ ìƒì„¸ ë‚´ìš©",
    "file_path": "src/App.tsx",
    "period_days": 7
  }
  ```
- **ì„¤ëª…**: íŠ¹ì • íŒŒì¼ì´ë‚˜ ê¸°ëŠ¥ì— ëŒ€í•œ ê³ ì†Œì¥(íŒê²° ìš”ì²­)ì„ ìƒì„±í•©ë‹ˆë‹¤. ìë™ìœ¼ë¡œ `YYYY-XXXX...` í˜•ì‹ì˜ ì‚¬ê±´ ë²ˆí˜¸ê°€ ë¶€ì—¬ë©ë‹ˆë‹¤.
- **ì‘ë‹µ**: ìƒì„±ëœ íŒê²° ê°ì²´ (ì‚¬ê±´ ë²ˆí˜¸ í¬í•¨)

### 10. íŒê²° ëª©ë¡ ì¡°íšŒ
- **URL**: `/judgments`
- **Method**: `GET`
- **Query Parameters**: 
  - `status`: (ì„ íƒ) `pending` ë˜ëŠ” `completed`
  - `page`: í˜ì´ì§€ ë²ˆí˜¸
  - `per_page`: í˜ì´ì§€ë‹¹ ê°œìˆ˜
- **ì„¤ëª…**: ì‚¬ìš©ìê°€ ì ‘ìˆ˜í•œ ëª¨ë“  íŒê²° ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.

### 11. íŒê²° ìƒì„¸ ì¡°íšŒ
- **URL**: `/judgments/{judgment_id}`
- **Method**: `GET`
- **ì„¤ëª…**: íŠ¹ì • íŒê²°ì˜ ìƒì„¸ ì •ë³´, ì‚¬ê±´ ë²ˆí˜¸, ìš©ì˜ì ëª©ë¡(Suspects), ìµœì¢… íŒê²°(Blame) ì •ë³´ë¥¼ ëª¨ë‘ ë°˜í™˜í•©ë‹ˆë‹¤.

### 12. ğŸ” ìš©ì˜ì ë¶„ì„ (AI Analysis)
- **URL**: `/judgments/{judgment_id}/analyze`
- **Method**: `POST`
- **ì„¤ëª…**: **[í•µì‹¬ ê¸°ëŠ¥]** Gemini AIë¥¼ ì‚¬ìš©í•˜ì—¬ ê´€ë ¨ ì»¤ë°‹ ê¸°ë¡ì„ ë¶„ì„í•˜ê³ , ê° ê°œë°œìì˜ ì±…ì„ ë¹„ìœ¨(Responsibility)ê³¼ ì‚¬ìœ ë¥¼ ë„ì¶œí•©ë‹ˆë‹¤.
- **ì‘ë‹µ ì˜ˆì‹œ**:
  ```json
  {
    "id": "...",
    "status": "completed",
    "suspects": [
      {
        "username": "bug_maker",
        "responsibility": 80,
        "reason": "í•´ë‹¹ íŒŒì¼ì˜ ìµœê·¼ 20ê°œ ì»¤ë°‹ ì¤‘ 15ê°œë¥¼ ì‘ì„±í•¨.",
        "last_commit_msg": "fix: attempt to fix bug"
      },
      ...
    ]
  }
  ```

### 13. íŒê²° ì‚­ì œ
- **URL**: `/judgments/{judgment_id}`
- **Method**: `DELETE`
- **ì„¤ëª…**: ì ‘ìˆ˜ëœ íŒê²°ì„ ì‚­ì œí•©ë‹ˆë‹¤.

---

## ğŸ”¥ ì²˜ë²Œ ë° íŒê²°ë¬¸ (Blame & Verdict) - `/judgments/.../blame`

### 14. ìµœì¢… íŒê²° ë‚´ë¦¬ê¸° (Blame ìƒì„±)
- **URL**: `/judgments/{judgment_id}/blame`
- **Method**: `POST`
- **Body**: `{}` (ë¹ˆ ê°ì²´)
- **ì„¤ëª…**: ê°€ì¥ ì±…ì„ì´ í° ìš©ì˜ì(Main Suspect)ë¥¼ ì„ ì •í•˜ê³ , **ì„¸ ê°€ì§€ ê°•ë„ì˜ íŒê²° ë©”ì‹œì§€ë¥¼ ëª¨ë‘ ìƒì„±**í•©ë‹ˆë‹¤.
  - `mild` (ìˆœí•œë§›): ì •ì¤‘í•œ ìˆ˜ì • ìš”ì²­
  - `medium` (ì¤‘ê°„ë§›): ìœ ë¨¸ëŸ¬ìŠ¤í•œ ì§€ì 
  - `spicy` (ë§¤ìš´ë§›): ê°•ë ¥í•˜ê³  ì§ì„¤ì ì¸ ë¹„ë‚œ(ì¬ë¯¸ ìœ„ì£¼)
- **ì‘ë‹µ ì˜ˆì‹œ**:
  ```json
  {
    "id": "uuid",
    "target_username": "hjy080530",
    "target_avatar": "https://...",
    "responsibility": 70,
    "reason": "ìµœê·¼ ì»¤ë°‹ ì‘ì„±ì",
    "messages": {
      "mild": [
        "hjy080530ë‹˜ í™•ì¸ ë¶€íƒë“œë ¤ìš”.",
        "ì‹ íƒìŠ¤ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
        "ì‹œê°„ ë˜ì‹¤ ë•Œ ë´ì£¼ì„¸ìš”~ ğŸ™"
      ],
      "medium": [
        "hjy080530ë‹˜ 70% ì±…ì„ì´ì‹œë„¤ìš”!",
        "ì˜ˆì œ íŒŒì¼ì´ í„°ì¡Œì–´ìš”.",
        "ì»¤í”¼ í•œ ì” ì‚¬ì£¼ì‹œì£ ? â˜•"
      ],
      "spicy": [
        "ì•¼ hjy080530 ì´ê±° ëˆ„ê°€ ì§  ê±°ì•¼.",
        "ì‹ íƒìŠ¤ ì—ëŸ¬ í„°íŠ¸ë ¤ë†“ê³ .",
        "ì±…ì„ì§€ì„¸ìš” ì„ ë°°ë‹˜! ğŸ”¥"
      ]
    },
    "image_url": null,
    "created_at": "2025-12-21T12:00:00Z"
  }
  ```

### 15. íŒê²° ê²°ê³¼ ì¡°íšŒ
- **URL**: `/judgments/{judgment_id}/blame`
- **Method**: `GET`
- **ì„¤ëª…**: ì´ë¯¸ ìƒì„±ëœ íŒê²° ê²°ê³¼ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.

### 16. ğŸ“· íŒê²°ë¬¸ ì´ë¯¸ì§€ ìƒì„±
- **URL**: `/judgments/{judgment_id}/blame/image`
- **Method**: `POST`
- **ì„¤ëª…**: íŒê²° ë‚´ìš©, ë²”ì¸ì˜ ì•„ë°”íƒ€, ì±…ì„ ë¹„ìœ¨ ë“±ì´ í¬í•¨ëœ **ì‹œê°ì ì¸ íŒê²°ë¬¸ ì¹´ë“œ ì´ë¯¸ì§€**ë¥¼ ìƒì„±í•˜ì—¬ Supabase Storageì— ì—…ë¡œë“œí•©ë‹ˆë‹¤.
- **ì‘ë‹µ**:
  ```json
  {
    "image_url": "https://supabase.../blame-images/....png"
  }
  ```

---

## ğŸ“¦ ë°ì´í„° ëª¨ë¸ (Models)

### User (ì‚¬ìš©ì)
| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… |
|---|---|---|
| `id` | UUID | ì‚¬ìš©ì ê³ ìœ  ID |
| `username` | String | GitHub ì‚¬ìš©ìëª… |
| `avatar_url` | String | í”„ë¡œí•„ ì´ë¯¸ì§€ URL |

### Judgment (íŒê²°/ê³ ì†Œì¥)
| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… |
|---|---|---|
| `id` | UUID | íŒê²° ê³ ìœ  ID |
| `case_number` | String | **ì‚¬ê±´ ë²ˆí˜¸** (ì˜ˆ: 2024-1234-5678) |
| `repo_name` | String | ë ˆí¬ì§€í† ë¦¬ ì´ë¦„ |
| `title` | String | ì‚¬ê±´(ë²„ê·¸) ì œëª© |
| `status` | String | `pending`(ë¶„ì„ì „), `completed`(ë¶„ì„ì™„ë£Œ) |
| `suspects` | List | ìš©ì˜ì ëª©ë¡ í¬í•¨ |

### Suspect (ìš©ì˜ì)
| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… |
|---|---|---|
| `username` | String | ìš©ì˜ì GitHub ID |
| `responsibility` | Integer | **ì±…ì„ ë¹„ìœ¨ (0-100%)** |
| `reason` | String | AIê°€ ë¶„ì„í•œ ì§€ëª© ì‚¬ìœ  |

### Blame (ìµœì¢… íŒê²°)
| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… |
|---|---|---|
| `target_username` | String | ìµœì¢… ë²”ì¸ |
| `message` | String | **AI íŒê²° ë©”ì‹œì§€** |
| `intensity` | String | ë©”ì‹œì§€ ê°•ë„ (mild/medium/spicy) |
| `image_url` | String | íŒê²°ë¬¸ ì´ë¯¸ì§€ URL |
